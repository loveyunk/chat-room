import React from 'react';
import Button from 'material-ui/Button';
import Icon from 'material-ui/Icon';
import TextField from 'material-ui/TextField';
import 'rc-color-picker/assets/index.css';
import ColorPicker from 'rc-color-picker';
import styles from './MessageInput.less';
import io from 'socket.io-client';
import EmojiPicker from 'emoji-picker-react';
import Emoji from 'react-emoji-render';

const socket = io();

class MessageInput extends React.Component {

constructor(props) {
super(props);
this.state = {
message: [],
color: '#00acff',
emoji: ''
};
}

handleMessage = () => {
const {message} = this.state;

if (message) {
const messageObj = {
uid: this.props.uid,
username: this.props.username,
content: message,
sex: this.props.sex,
time: this.getTime(),
color: this.state.color
};

socket.emit('updateMessages', messageObj);

this.setState({
message: ''
});
}
};

handleKeyPress = (e) => {
if (e.key === 'Enter') {
this.handleMessage();
}
};

handleChange = name => event => {
console.log(event.target.value);
// t.push(<Emoji text=':ok:'/>);
this.setState({
[name]: this.state.message.push(event.target.value)
});
console.log(this.state.message);
};

getTime() {
const date = new Date();
let [hour, minute] = [date.getHours(), date.getMinutes()];
hour = hour < 10 ? '0' + hour : hour;
minute = minute < 10 ? '0' + minute : minute;

return hour + ':' + minute
}

send = () => {
this.handleMessage();
};

handleEmoji = (val, obj) => {
let t = this.state.message;
console.log(this.state.message);

t.push(<Emoji text=':ok:'/>);

this.setState({
message: t
});

// console.log(obj.name);
// console.log(this.textInput.);
// let p = document.createElement('Emoji');
// p.innerHTML = '<Emoji text=\':ok:\'>';
    // p.setAttribute('text', ':ok:');
    // this.textInput.appendChild(p);
    // this.forceUpdate();
    // this.setState({
    //     emoji: obj.name
    // });
    };

    changeHandler = (color) => {
    this.setState({
    color
    });
    };

    render() {

    const bar = (<div>{}</div>);

    return (
    <div className={styles.container}>
        <EmojiPicker onEmojiClick={this.handleEmoji}/>

            <div className={styles.colorPickerWrapper}>
                <ColorPicker
                    color={this.state.color}
                    onChange={this.changeHandler}
                />
            </div>
            <Button className={styles.send} onClick={this.send} variant="fab" color="primary">
                <Icon>send</Icon>
            </Button>
            <div className={styles.emojiPicker}>
            </div>
            <TextField
                multiline
                rows={5}
                rowsMax={60}
                placeholder="Type your message..."
                fullWidth
                className={styles.textField}
                onKeyPress={this.handleKeyPress}
                value={this.state.message}
                onChange={this.handleChange('message')}
            />


            <div className={styles.textArea} contentEditable={true}>
                {/*{this.state.message}*/}
                {/*<Emoji text=":ok:" />*/}
                {this.state.message.map(item => (
                <div>{item}</div>
                ))}
            </div>

            {/*<Emoji text={`:${this.state.emoji}:`} />*/}
    </div>
    );
    }
    }

    export default MessageInput;
